---
sidebar: sidebar 
permalink: create-replication.html 
keywords: replication, replicate, data protection, disaster recovery, data loss 
summary: 'Créez une relation de réplication pour un système de fichiers FSX pour ONTAP afin d"éviter la perte de données en cas d"incident imprévu.' 
---
= Répliquez les données vers FSx pour ONTAP dans NetApp Workload Factory
:allow-uri-read: 
:icons: font
:imagesdir: ./media/


[role="lead"]
Créez une relation de réplication pour un système de fichiers FSx for ONTAP dans NetApp Workload Factory afin d'éviter une perte de données en cas de sinistre imprévu. Vous pouvez répliquer des données entre deux systèmes de fichiers FSx for ONTAP, ou entre un système ONTAP sur site et un système de fichiers FSx for ONTAP.

Pour la migration de storage VM, vous devez effectuer l'opération de basculement immédiatement après avoir créé une relation de réplication.



== Description de la tâche

La réplication protège vos données en cas de catastrophe affectant votre région ; elle peut également être utilisée à des fins de migration.

Les volumes répliqués dans le système de fichiers cible sont des volumes de protection des données (DP) et suivent le format de nommage suivant : `{OriginalVolumeName}_copy`.

Si vous répliquez un volume source contenant des fichiers immuables, le volume cible et le système de fichiers restent verrouillés jusqu'à la fin de la période de rétention du volume source. La fonctionnalité de fichiers immuables est disponible lorsque vous link:create-volume.html["créer un volume"] pour un système de fichiers FSx for ONTAP.

[NOTE]
====
* La réplication n'est pas prise en charge pour les volumes bloc utilisant les protocoles iSCSI ou NVMe.
* Vous pouvez répliquer un volume source (lecture/écriture) ou un volume de protection des données (DP). La réplication en cascade est prise en charge, mais pas un troisième saut. En savoir plus sur link:https://review.docs.netapp.com/us-en/workload-fsx-ontap_cascade-replication/cascade-replication.html["réplication en cascade"^].


====


=== Cas d'utilisation de la migration

Lorsque vous sélectionnez le cas d'utilisation de migration, vous pouvez choisir de répliquer les données et les paramètres de configuration d'une seule machine virtuelle de stockage. Lorsque vous migrez simultanément des données et des paramètres de configuration, assurez-vous que la dernière réplication du volume a été effectuée au cours des dernières 24 heures. Tous les volumes de la même machine virtuelle de stockage doivent être sélectionnés pour utiliser cette fonctionnalité. La stratégie de hiérarchisation de tous les volumes est, par défaut, celle du volume source, ce qui est recommandé pour les cas d'utilisation de migration.

Workload Factory prend en charge la réplication de migration entre les systèmes de stockage suivants.

* Systèmes ONTAP sur site et systèmes de fichiers FSx pour ONTAP
* Cloud Volumes ONTAP et systèmes de fichiers FSx for ONTAP
* FSx pour ONTAP et systèmes de fichiers FSx pour ONTAP
+
** Première à première génération
** Première à deuxième génération
** Seconde à seconde génération




Pour migrer les données et les paramètres de configuration du VM de stockage, vous devez effectuer deux opérations.

. <<Créer une relation de réplication,Créer une relation de réplication>>, sélectionnez *Migration* comme cas d'utilisation et sélectionnez *Replicate storage VM configuration*.
. <<Réplication de basculement pour les cas d'utilisation de migration,Réplication de basculement pour les cas d'utilisation de migration>> pour migrer définitivement les données et les paramètres de configuration du système de fichiers source vers le système de fichiers cible FSx for ONTAP.




== Créer une relation de réplication

Répliquez des données entre deux systèmes de fichiers FSx pour ONTAP, ou entre un système ONTAP sur site et un système de fichiers FSx pour ONTAP.

.Avant de commencer
Examinez ces exigences avant de commencer.

* Vous devez disposer d'un système de fichiers FSx for ONTAP à utiliser comme cible dans la relation de réplication.
* Le système de fichiers FSx for ONTAP que vous utilisez pour la relation de réplication doit être associé à un lien. link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html["Apprenez à associer un lien existant ou à créer et associer un nouveau lien"]. Une fois le lien associé, revenez à cette opération.
* Pour la réplication d'un système ONTAP sur site vers un système de fichiers FSx for ONTAP, assurez-vous d'avoir découvert le système ONTAP sur site.
* La réplication n'est pas prise en charge pour les volumes dans un état autre que disponible, créé ou mal configuré, et lorsque la version d'ONTAP n'est pas compatible.
* Pour les cas d'utilisation liés à la migration, assurez-vous que la dernière réplication du volume a été effectuée au cours des dernières 24 heures avant de créer une relation de réplication avec les données et les paramètres de configuration du storage VM.


.Étapes
. Connectez-vous à l'aide de l'un des link:https://docs.netapp.com/us-en/workload-setup-admin/console-experiences.html["expériences de la console"^].
. Sélectionnez le menu image:workloads-menu-icon.png["L'icône du menu hamburger permet d'accéder aux charges de travail telles que le stockage, l'analyse de données d'entreprise (EDA), l'intelligence artificielle (IA), les bases de données, VMware et l'administration."] puis sélectionnez *Stockage*.
. Dans le menu Stockage, sélectionnez *FSx pour ONTAP*.
. Dans *FSx for ONTAP*, sélectionnez le système de fichiers qui contient le(s) volume(s) à répliquer.
. Répliquer tous les volumes d'un système de fichiers ou répliquer les volumes sélectionnés.
+
** Pour répliquer tous les volumes d'un système de fichiers : dans la vue d'ensemble du système de fichiers, sélectionnez *répliquer les données*.
** Pour répliquer des volumes sélectionnés : dans l'aperçu du système de fichiers, sélectionnez l'onglet *volumes*.
+
Dans le tableau volumes, sélectionnez un ou plusieurs volumes, puis sélectionnez *replicate data*.



. Sur la page de données répliquées, sous cible de réplication, indiquez les informations suivantes :
+
.. *Cas d’utilisation* : sélectionnez l’un des cas d’utilisation suivants pour la réplication.  En fonction du cas d'utilisation sélectionné, Workload Factory remplit le formulaire avec les valeurs recommandées conformément aux meilleures pratiques.  Vous pouvez accepter les valeurs recommandées ou apporter des modifications au fur et à mesure que vous remplissez le formulaire.
+
*** Migration : transfère vos données vers le système de fichiers cible FSX pour ONTAP
+
*Réplication de la configuration de la machine virtuelle de stockage* : Vous pouvez, en option, sélectionner la réplication des données et des paramètres de configuration d'une seule machine virtuelle de stockage. Lorsque vous migrez simultanément des données et des paramètres de configuration, assurez-vous que la dernière réplication du volume a été effectuée au cours des dernières 24 heures. Tous les volumes de la même machine virtuelle de stockage doivent être sélectionnés pour utiliser cette fonctionnalité. La stratégie de hiérarchisation de tous les volumes est, par défaut, celle du volume source, ce qui est recommandé pour les cas d'utilisation de migration.

*** Reprise après incident à chaud : assure une haute disponibilité et une reprise après incident rapide pour les workloads stratégiques
*** Reprise après incident des données inactives ou d'archivage :
+
**** Reprise d'activité à froid : utilise des objectifs de délai de restauration (RTO) et des objets de point de restauration (RPO) plus longs pour réduire les coûts
**** Archive : réplique les données pour un stockage et une conformité à long terme


*** Autre
+
En outre, la sélection du cas d'utilisation détermine la règle de réplication ou la règle SnapMirror (ONTAP). Les termes utilisés pour décrire les règles de réplication proviennent de link:https://docs.netapp.com/us-en/ontap/data-protection/default-protection-policies-concept.html["Documentation sur ONTAP 9"^].

+
**** Pour la migration et les autres, la règle de réplication est appelée _MirrorAllsnapshots_. _MirrorAllsnapshots_ est une règle asynchrone pour la mise en miroir de tous les snapshots et du dernier système de fichiers actif.
**** Pour la reprise après incident à chaud, à froid ou d'archivage, la stratégie de réplication est appelée _MirrorAndVault_. _MirrorAndVault_ est une règle asynchrone et de coffre-fort pour la mise en miroir du dernier système de fichiers actif et des snapshots quotidiens et hebdomadaires.
+
Pour tous les cas d'utilisation, si vous activez les snapshots pour la conservation à long terme, la règle de réplication par défaut est _MirrorAndVault_.





.. *FSX pour système de fichiers ONTAP* : sélectionnez les informations d'identification, la région et le nom du système de fichiers FSX pour ONTAP pour le système de fichiers cible FSX pour ONTAP.
.. *Nom de la VM de stockage* : sélectionnez la VM de stockage dans le menu déroulant. La machine virtuelle de stockage que vous sélectionnez est la cible de tous les volumes sélectionnés dans cette relation de réplication.
.. *Nom du volume* : le nom du volume cible est généré automatiquement au format suivant `{OriginalVolumeName}_copy`. Vous pouvez utiliser le nom du volume généré automatiquement ou entrer un autre nom de volume.
.. *Règle de hiérarchisation* : sélectionnez la règle de hiérarchisation pour les données stockées dans le volume cible. La règle de Tiering est définie par défaut sur la règle de hiérarchisation recommandée pour le cas d'utilisation que vous avez sélectionné.
+
_Balanced (Auto)_ est la stratégie de hiérarchisation par défaut lors de la création d'un volume à l'aide de la console Workload Factory.  Pour plus d'informations sur les politiques de hiérarchisation des volumes, reportez-vous àlink:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/volume-storage-capacity.html#data-tiering-policy["Capacité de stockage du volume"^] dans la documentation AWS FSx pour NetApp ONTAP .  Notez que Workload Factory utilise des noms basés sur des cas d'utilisation dans la console Workload Factory pour les stratégies de hiérarchisation et inclut les noms de stratégie de hiérarchisation FSx pour ONTAP entre parenthèses.

+
Si vous avez sélectionné le cas d’utilisation de migration, Workload Factory choisit automatiquement de copier la stratégie de hiérarchisation du volume source sur le volume cible.  Vous pouvez désélectionner la copie de la politique de hiérarchisation et sélectionner une politique de hiérarchisation qui s'applique au volume sélectionné pour la réplication.

.. *Taux de transfert max.* : sélectionnez *Limited* et entrez la limite de transfert max. En Mo/s. Vous pouvez également sélectionner *Illimité*.
+
Sans limite, les performances du réseau et des applications peuvent diminuer. Nous recommandons également un taux de transfert illimité pour les systèmes de fichiers FSX pour ONTAP pour les workloads stratégiques, par exemple ceux utilisés principalement pour la reprise d'activité.



. Sous Paramètres de réplication, fournissez les informations suivantes :
+
.. *Intervalle de réplication* : sélectionnez la fréquence à laquelle les instantanés sont transférés du volume source vers le volume cible.
.. *Conservation à long terme* : éventuellement, activez les instantanés pour la conservation à long terme. La conservation à long terme permet aux services de l'entreprise de continuer de fonctionner même en cas de défaillance complète d'un site, ce qui permet aux applications de basculer en toute transparence grâce à une copie secondaire.
+
Les réplications sans rétention à long terme utilisent la stratégie _MirrorAllSnapshots_. L'activation de la rétention à long terme affecte la stratégie _MirrorAndVault_ à la réplication.

+
Si vous activez la conservation à long terme, sélectionnez une règle existante ou créez une nouvelle règle pour définir les snapshots à répliquer et le nombre à conserver.

+

NOTE: Les étiquettes de source et de cible correspondantes sont requises pour la conservation à long terme. Si vous le souhaitez, Workload Factory peut créer des étiquettes manquantes pour vous.

+
*** *Choisissez une stratégie existante* : sélectionnez une stratégie existante dans le menu déroulant.
*** *Créer une nouvelle politique* : saisissez un *nom de politique*.


.. *Instantanés immuables* : Facultatif. Sélectionnez *Activer les instantanés immuables* pour empêcher la suppression des instantanés pris dans cette stratégie pendant la période de conservation.
+
*** Définissez la *période de conservation* en nombre d'heures, de jours, de mois ou d'années.
*** *Stratégies Snapshot* : dans le tableau, sélectionnez la fréquence de la règle de snapshot et le nombre de copies à conserver. Vous pouvez sélectionner plusieurs règles de snapshot.


.. *Point d'accès S3* : Vous pouvez, en option, connecter un point d'accès S3 pour accéder aux données du système de fichiers FSx pour ONTAP résidant sur des volumes NFS ou SMB/CIFS via les API AWS S3. Seul le type d'accès aux fichiers est pris en charge. Veuillez fournir les détails suivants :
+
*** *Nom du point d'accès S3* : Saisissez le nom du point d'accès S3.
*** *Utilisateur* : sélectionnez un utilisateur existant avec accès au volume ou créez un nouvel utilisateur.
*** *Type d'utilisateur* : sélectionnez *UNIX* ou *Windows* comme type d'utilisateur.
*** *Configuration réseau* : Sélectionnez *Internet* ou *Virtual private cloud (VPC)*. Le type de réseau que vous choisissez détermine si le point d'accès est accessible depuis Internet ou limité à un VPC spécifique.
*** *Activer les métadonnées* : L’activation des métadonnées crée une table S3 contenant tous les objets accessibles par le point d'accès S3, que vous pouvez utiliser pour l’audit, la gouvernance, l’automatisation, l’analyse et l’optimisation. L’activation des métadonnées engendre des coûts AWS supplémentaires. Consultez link:https://aws.amazon.com/s3/pricing/["Documentation tarifaire Amazon S3"^] pour plus d’informations.


.. *Étiquettes de point d'accès S3* : Vous pouvez éventuellement ajouter jusqu'à 50 étiquettes.




. Sélectionnez *Créer*.


.Résultat
La relation de réplication apparaît dans l'onglet *relations de réplication* du système de fichiers cible FSX pour ONTAP.

Si vous avez créé une relation de réplication à des fins de migration, vous devez basculer tous les volumes et leur machine virtuelle de stockage associée pour terminer la migration des données et des paramètres de configuration de la machine virtuelle de stockage vers le système de fichiers FSx for ONTAP cible.



== Réplication de basculement pour les cas d'utilisation de migration

Après avoir créé une relation de réplication pour un cas d'utilisation de migration, vous devez effectuer un basculement de la réplication afin de finaliser la migration des données et des paramètres de configuration de la machine virtuelle de stockage vers un système de fichiers FSx for ONTAP cible. Le basculement de la réplication migre définitivement les données et les paramètres de configuration de la machine virtuelle de stockage du système de fichiers source vers le système de fichiers FSx for ONTAP cible. Lors du basculement, les données sont répliquées une dernière fois. Le système supprime le ou les volumes sources après la fin du basculement. Vous ne pouvez pas annuler cette action.

.Avant de commencer
Examinez ces exigences avant de commencer.

* Empêchez tout accès client à votre machine virtuelle de stockage avant de basculer la réplication.
* Assurez-vous qu'aucun volume source ne sert de données avant de basculer la réplication.
* Assurez-vous que les données sont synchronisées entre les volumes source et cible avant de procéder à la bascule de la réplication.
* Le système de fichiers FSx for ONTAP que vous utilisez pour la relation de réplication doit être associé à un lien. link:https://docs.netapp.com/us-en/workload-fsx-ontap/create-link.html["Apprenez à associer un lien existant ou à créer et associer un nouveau lien"]. Une fois le lien associé, revenez à cette opération.


.Étapes
. Connectez-vous à l'aide de l'un des link:https://docs.netapp.com/us-en/workload-setup-admin/console-experiences.html["expériences de la console"^].
. Sélectionnez le menu image:workloads-menu-icon.png["L'icône du menu hamburger permet d'accéder aux charges de travail telles que le stockage, l'analyse de données d'entreprise (EDA), l'intelligence artificielle (IA), les bases de données, VMware et l'administration."] puis sélectionnez *Stockage*.
. Dans le menu Stockage, sélectionnez *FSx pour ONTAP*.
. Dans *FSx for ONTAP*, sélectionnez le système de fichiers qui contient le(s) volume(s) à répliquer.
. Sélectionnez l’onglet *Replication relationships*.
. Dans le tableau des relations de réplication, sélectionnez la relation de réplication à basculer, puis sélectionnez *Cut over replication*.
. Vérifiez les informations dans la boîte de dialogue Cut over replication, puis tapez _cut over_ pour confirmer.


. Sélectionnez *Cut over*.


.Résultat
Après la bascule, les volumes sources sont supprimés et les volumes cibles deviennent accessibles en lecture/écriture. Vous pouvez link:change-tiering-policy.html["modifier la politique de hiérarchisation"] pour les volumes cibles après la bascule.
